[workspace]
authors   = ["zaynram <ramdasszayn@gmail.com>"]
channels  = ["conda-forge"]
name      = "crosbydev.n8n"
platforms = ["win-64"]
preview   = ["pixi-build"]
version   = "0.0.1"


[environments]
default = ["remote", "service"]
remote  = ["remote"]
service = ["service"]

[tasks]
  [tasks.push]
  args = [
    { arg = "DIRECTORY", default = "." },
    { arg = "MESSAGE", default = "auto" },
  ]
  cmd = "cd {{ DIRECTORY }} && git add --all && git commit -m '{{ MESSAGE }}' && git push"
  [tasks.parse]
  args = [{ arg = "CONTENT" }, { arg = "MODE" }]
  cmd  = "python -m n8n_py.parser --content {{ CONTENT }} --mode {{ MODE }}"


[dependencies]
bs4        = ">=4.13.5,<5"
ipykernel  = "*"
ipywidgets = "*"
python     = "==3.13"
rampy      = { git = "https://github.com/zaynram/ramda-py", branch = "master" }
spacy      = ">=3.8.7,<4"

[pypi-dependencies]
n8n-py = { path = "python", editable = true }

[feature.remote]
  [feature.remote.tasks]
  remote = "python scripts/server-cmd.py"
    [feature.remote.tasks.sync]
    cmd        = "python scripts/server-cmd.py 'git pull origin main && ./scripts/service.ps1 reload'"
    depends-on = [{ task = "push" }]


[feature.service]
  [feature.service.tasks]
  serve = "pixi run n8n &"
    [feature.service.tasks.update]
    cmd = "git pull --recurse-submodules"
    [feature.service.tasks.n8n]
    cmd = "bun x n8n"
    cwd = "service"
      [feature.service.tasks.n8n.env]
      DB_SQLITE_POOL_SIZE             = '1'
      GENERIC_TIMEZONE                = 'America/Chicago'
      N8N_BASIC_AUTH_ACTIVE           = 'true'
      N8N_BLOCK_ENV_ACCESS_IN_NODE    = 'false'
      N8N_DIAGNOSTICS_ENABLED         = 'false'
      N8N_GIT_NODE_DISABLE_BARE_REPOS = 'false'
      N8N_HOST                        = 'ccn8n.org'
      N8N_LOG_LEVEL                   = 'info'
      N8N_PORT                        = '5678'
      N8N_PREVIEW_MODE                = 'true'
      N8N_PROTOCOL                    = 'https'
      N8N_PROXY_HOPS                  = '1'
      N8N_RUNNERS_ENABLED             = 'true'
      N8N_TEMPLATES_ENABLED           = 'false'
      N8N_USER_FOLDER                 = './'
      NODE_ENV                        = 'production'
      WEBHOOK_URL                     = 'https://ccn8n.org/'
